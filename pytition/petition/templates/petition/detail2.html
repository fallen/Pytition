{% extends 'petition/base.html' %}
{% load static %}
{% load i18n %}
{% load widget_tweaks %}


{% block title %}{% autoescape off %}{{ petition.raw_title }}{% endautoescape %}{% endblock title %}


<!-- Extra meta -->
{% block extrameta %}
    <meta name="description" content="{% autoescape off %}{{ petition.raw_title }}{% endautoescape %}"/>

    <meta property="og:title" content="{% autoescape off %}{{ petition.raw_title }}{% endautoescape %}"/>
    {% if petition.twitter_description %}
        <meta property="og:description"
              content="{% autoescape off%}{{ petition.raw_twitter_description }}{% endautoescape %}"/>
    {% else %}
        <meta property="og:description" content="{% autoescape off %}{{ petition.raw_text }}{% endautoescape %}"/>
    {% endif %}
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://petition.antipub.org/petition/{{ petition.id }}/"/>
    <meta property="og:site_name" content="petition.antipub.org"/>
    {% if petition.twitter_image %}
        <meta property="og:image" content="{{ petition.twitter_image }}"/>
    {% endif %}

    <meta itemprop="name" content="{% autoescape off %}{{ petition.raw_title }}{% endautoescape %}"/>
    {% if petition.twitter_description %}
        <meta itemprop="description"
              content="{% autoescape off %}{{ petition.raw_twitter_description }}{% endautoescape %}"/>
    {% else %}
        <meta itemprop="description" content="{% autoescape off %}{{ petition.raw_text }}{% endautoescape %}"/>
    {% endif %}
    <!-- FIXME: <meta itemprop="url" content=""/> //-->

    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:creator" content="@yannsionneau"/>
    <meta name="twitter:site" content="{% autoescape off %}{{ petition.org_twitter_handle }}{% endautoescape %}"/>
    <meta name="twitter:title" content="{% autoescape off %}{{ petition.raw_title }}{% endautoescape %}"/>
    {% if petition.twitter_description %}
        <meta name="twitter:description"
              content="{% autoescape off %}{{ petition.raw_twitter_description }}{% endautoescape %}"/>
    {% else %}
        <meta name="twitter:description" content="{% autoescape off %}{{ petition.raw_text }}{% endautoescape %}"/>
    {% endif %}
    {% if petition.twitter_image %}
        <meta name="twitter:image" content="{{ petition.twitter_image }}"/>
    {% endif %}

{% endblock %}

{% block extracss %}
    <link href="{% static "typeahead.css" %}" rel="stylesheet" type="text/css">
    <link href="{% static "petition.css" %}" rel="stylesheet" type="text/css">
    <style type="text/css">
    {% if petition.linear_gradient_direction != petition.NO %}
    body {
        background: linear-gradient({{ petition.linear_gradient_direction}}, {{ petition.gradient_from }}, {{ petition.gradient_to }});
    }
    {% endif %}
    .content {
        min-height: 500px;
    }
     body{
    ;background-position:center top;background-attachment:fixed;background-size:cover}
@media screen and (min-width:768px){
body{
}
}a{color:#00f}.share a{color:#ffeb1f}p.lead{line-height:1.2}h1{padding-left:15px;padding-right:15px;color:#000;font-weight:800;text-transform:uppercase;font-size:50px}@media screen and (min-width:768px){h1{font-size:62px;float:left;width:60%;padding-left:30px;padding-right:30px}}@media screen and (min-width:992px){h1{width:66.666%}}@media screen and (min-width:1090px){h1{width:69%}}.content{position:relative;overflow:hidden;overflow-wrap:break-word;}.formular,.presentation{min-height:1px;padding-left:15px;padding-right:15px;position:relative;width:100%;float:right}.counter{display:none}.counter.show{display:block}.petition-wrapper{background-color:#fff;overflow:hidden;position:relative}.presentation{padding-bottom:3em;padding-left:15px;padding-right:15px}@media screen and (min-width:768px){.presentation{float:left;width:60%;padding-left:30px;padding-right:30px}}@media screen and (min-width:992px){.presentation{width:66.666%}}@media screen and (min-width:1090px){.presentation{width:69%}}.presentation img{max-width:100%; object-fit: scale-down} .formular{background-color:#666;color:#fff;height:100%;margin-bottom:1em}.formular .form-wrapper{padding-top:20px}@media screen and (min-width:768px){.formular{position:absolute;overflow:auto;top:0;right:0;bottom:0;width:40%}}@media screen and (min-width:992px){.formular{width:33.334%}}@media screen and (min-width:1090px){.formular{width:31%}}.show-form{z-index:100;background-color:#666;position:fixed;top:0;left:0;right:0;transform:translateY(-100%)}.show-form .wrapper{padding:7px 15px}.fixed .show-form{transform:translateY(0);transition:transform .6s}#eaerrors{margin-bottom:1em}#eaerrors ol,#eaerrors ul{padding-left:0;list-style-type:none}#email_okDiv,#utm_campaignDiv,#utm_contentDiv,#utm_mediumDiv,#utm_sourceDiv,#utm_termDiv{}#email_okDiv label{display:inline}.eaErrorMessageHeader{font-size:1.7em}@media screen and (max-width:768px){.eaFullWidthContent{margin-top:0!important}}.eaFullWidthContent .eaErrorMessage{display:none}.eaFullWidthContent,.eaSubmitResetButtonGroup{margin-bottom:0;display:block}.eaFullWidthContent input[type=submit],.eaSubmitResetButtonGroup input[type=submit]{width:100%}.eaFormField{margin-bottom:10px}.btn-primary,.eaSubmitButton{color:#666;text-shadow:1px 1px 1px #fff}.eaSubmitButton{font-size:20px;padding:12px 20px}@media screen and (min-width:768px){.show-form{display:none}}.intro{font-size:21px;line-height:1.2}.sign{color:#ffeb1f}.counter{margin-top:18px}.reassurance{padding-bottom:30px;padding-top:20px;font-size:11px}.footer{padding:20px 0;text-align:left;background-color:#020;color:#99979c}.footer .footer-links{padding:0}.footer li{display:inline-block;padding-right:20px}.footer li a{color:#fff}.footer p a,.footer p a:hover{color:#99979c}.footer p a:hover{text-decoration:underline}input[type=email],input[type=tel],input[type=text]{padding:5px 6px; color: #555}.share-top{clear:both;padding:12px 15px 20px}@media screen and (min-width:768px){.share-top{padding-left:30px;padding-right:30px}}.share-top .share-item{color:#fff;padding:2px 6px;display:inline;font-weight:700;margin-right:4px;font-size:14px}.share-top .share-item#share-facebook{background-color:#4865b5}.share-top .share-item#share-twitter{background-color:#00acee}.share .share-item{text-align:center;display:block;padding:5px;cursor:pointer;margin:0 3px;font-size:4em}a.share-item:active,a.share-item:focus,a.share-item:hover{text-decoration:none}.progress{height:10px;border-radius:0}.assos{border-top:1px solid #666;padding-top:1.5em;margin:4em 0 2em;clear:both;overflow:hidden}.assos .asso{float:left;text-align:center;margin:0 20px;height:116px}.assos .asso img{width:inherit}.more h3{cursor:pointer}.more h3 .fa-stack{color:#666}.more h3 .fa-inverse{color:#ffeb1f}.more .more-content{display:none}

    </style>
{% endblock %}

{% block extrajshead %}
    <script>
      dataLayer = [];
    </script>
{% endblock %}

{% block container_type %}container petition{% endblock container_type %}

{% block login_next %}{% url "user_dashboard" %}{% endblock login_next %}

{% block main_content %}
<div class="show-form" id="show-form">
    <div class="wrapper">
        <button type="button" class="btn btn-primary btn-block">SIGNER</button>
    </div>
</div>

<div class="container petition">
    <div class="petition-wrapper">
        <div class="content">
            <h1>{% autoescape off%}{{ petition.title|striptags }}{% endautoescape %}</h1>
            <div class="formular" id="petition">
                <div class="form-wrapper">
                    <p class="intro" id="intro">
                        {% autoescape off%}{{ petition.side_text }}{% endautoescape %}
                        <br/>
                        <span class="sign">Signez la pétition&nbsp;!</span>
                    </p>
                    <div class="counter" id="counter">
                        <p>
                            Déjà <span id="nb-signatures">{{ petition.signature_number }}</span> signatures.
                            Objectif : <span class="format-number">{{ petition.target }}</span>
                        </p>
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" id="progress-bar"
                                 data-target="{{ petition.target }}">
                            </div>
                        </div>
                    </div>
                    <div id="form-sticky" class="form-sticky">
                        {% for message in messages %}
                            <div
                            {% if message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}
                                class="alert alert-danger" role="alert">
                            {% elif message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %}
                                class="alert alert-success" role="alert">
                            {% else %}
                                class="alert {{ message.tags }}" role="alert">
                            {% endif %}
                                    {{ message }}
                            </div>
                        {% endfor %}
                        <div class="fields">
                            <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
                            <!--<script type='text/javascript' src='{% static "jquery-1.7.1.js" %}'></script>-->
                            <script type='text/javascript'>var CONTEXT_ROOT = '/ea-action';</script>
                            <script type='text/javascript' src='{% static "eaCommon.js" %}'></script>
                            <script type='text/javascript' src='{% static "eaAJAX.js" %}'></script>
                            <script type='text/javascript' src='{% static "eacampaign.js" %}'></script>
                            <script type='text/javascript' src='{% static "typeahead.js" %}'></script>
                            <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
                            <style>
                                .fa-check-circle {
                                  width: 15px;
                                  margin: -25px 10px;
                                  float: right;
                                }
                                .fa-ban {
                                  width: 15px;
                                  margin: -25px 10px;
                                  float: right;
                                }
                                .fa-question-circle {
                                  width: 15px;
                                  margin: -25px 10px;
                                  float: right;
                                }
                                .invalid-feedback {
                                  display: none;
                                  width: 100%;
                                  margin-top: 0.25rem;
                                  font-size: 80%;
                                  color: #df382c;
                                }
                                .valid-feedback {
                                  display: none;
                                  width: 100%;
                                  margin-top: 0.25rem;
                                  font-size: 80%;
                                  color: #00ff00;
                                }
                            </style>
                            <form method='POST' name='petition' class='form-group'
                                  action='/petition/{{ petition.id }}/sign'>
                                {% csrf_token %}
                                {% for hidden_field in form.hidden_fields %}
                                    {{ hidden_field }}
                                {% endfor %}

                                {% if form.non_field_errors %}
                                    <div class="alert alert-danger" role="alert">
                                        {% for error in form.non_field_errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}

                                {% for field in form.visible_fields %}
                                    <div class="form-group has-feedback">
                                        {{ field.label_tag }}

                                        {% if form.is_bound %}
                                            {% if field.errors %}
                                                {{ field|add_class:"is-invalid" }}
                                        <span class="fas fa-question-circle form-control-feedback invalid-feedback"></span>
                                                {% for error in field.errors %}
                                                    <span class="invalid-feedback">
                                                        {{ error }}
                                                    </span>
                                                {% endfor %}
                                            {% else %}
                                                {{ field|add_class:"is-valid" }}
                                        <span class="far fa-check-circle form-control-feedback valid-feedback"></span>
                                            {% endif %}
                                        {% else %}
                                            {{ field }}
                                        {% endif %}

                                        {% if field.help_text %}
                                            <small class="form-text text-muted">{{ field.help_text }}</small>
                                        {% endif %}
                                    </div>
                                {% endfor %}


                                <span class="eaSubmitResetButtonGroup" id="eaFormButtonGroup_1"><input
                                        type="submit" class="eaSubmitButton" value="SIGNER"></span>
                            </form>
                        </div>
                        <div class="reassurance" id="reassurance">
                            <p style="text-align:justify">
                                {{ petition.sign_form_footer }}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="presentation">
                        {% autoescape off%}{{ petition.text }}{% endautoescape %}
            </div>
        </div>
    </div>
    <span style="float:right"><a href="https://github.com/fallen/Pytition/"><img src="{% static "GitHub_Logo_White.png" %}" width="100" height="41" /></a></span>
    <footer role="contentinfo" class="footer">
        <div class="container">
            <div class="footer-links">
                {% autoescape off %}{{ petition.footer_links }}{% endautoescape %}
            </div>
            <p>
                {% autoescape off %}{{ petition.footer_text }}{% endautoescape %}
            </p>
        </div>
    </footer>
    <script type="text/javascript" src="{% static "petition.js" %}"></script>
</div>
{% endblock main_content %}
